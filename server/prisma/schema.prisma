// –≠—Ç–æ –≤–∞—à —Ñ–∞–π–ª —Å—Ö–µ–º—ã Prisma.
// –£–∑–Ω–∞–π—Ç–µ –±–æ–ª—å—à–µ –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite" // –ò—Å–ø–æ–ª—å–∑—É–µ–º SQLite –¥–ª—è –ø—Ä–æ—Å—Ç–æ—Ç—ã (—Ñ–∞–π–ª dev.db)
  url      = "file:./dev.db"
}

// --- –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–¨ ---
model User {
  id          Int      @id @default(autoincrement())
  username    String   @unique
  password    String
  avatar      String?  // –°—Å—ã–ª–∫–∞ –Ω–∞ –∞–≤–∞—Ç–∞—Ä–∫—É
  status      String   @default("offline") // online, offline
  lastSeen    DateTime?
  
  // –°–ø–∏—Å–æ–∫ –¥—Ä—É–∑–µ–π —Ö—Ä–∞–Ω–∏—Ç—Å—è –∫–∞–∫ JSON –º–∞—Å—Å–∏–≤ ID "[1, 2, 5]"
  // (–ø—Ä–æ—Å—Ç–æ–π —Å–ø–æ—Å–æ–±, —á—Ç–æ–±—ã –Ω–µ –¥–µ–ª–∞—Ç—å —Å–ª–æ–∂–Ω—É—é many-to-many —Å–≤—è–∑—å —Å–µ–π—á–∞—Å)
  friendsData String?  

  // –°–≤—è–∑–∏
  servers     Member[]       // –í –∫–∞–∫–∏—Ö —Å–µ—Ä–≤–µ—Ä–∞—Ö —Å–æ—Å—Ç–æ–∏—Ç
  owned       Server[]       // –ö–∞–∫–∏–µ —Å–µ—Ä–≤–µ—Ä–∞ —Å–æ–∑–¥–∞–ª
  messages    Message[]      // –û—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
  reactions   Reaction[]     // –ü–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã–µ —Ä–µ–∞–∫—Ü–∏–∏
  
  // –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
  sentNotif   Notification[] @relation("Sender")
  recvNotif   Notification[] @relation("Receiver")
}

// --- –°–ï–†–í–ï–† ---
model Server {
  id          Int      @id @default(autoincrement())
  name        String
  icon        String?
  description String?
  
  ownerId     Int
  owner       User     @relation(fields: [ownerId], references: [id])

  channels    Channel[]
  members     Member[]
  invites     Notification[] // –ü—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è –Ω–∞ —ç—Ç–æ—Ç —Å–µ—Ä–≤–µ—Ä
}

// --- –£–ß–ê–°–¢–ù–ò–ö –°–ï–†–í–ï–†–ê ---
model Member {
  id       Int    @id @default(autoincrement())
  userId   Int
  serverId Int
  
  user     User   @relation(fields: [userId], references: [id])
  server   Server @relation(fields: [serverId], references: [id], onDelete: Cascade)
}

// --- –ö–ê–ù–ê–õ ---
model Channel {
  id       Int       @id @default(autoincrement())
  name     String
  type     String    @default("text") // "text" –∏–ª–∏ "voice"
  
  serverId Int
  server   Server    @relation(fields: [serverId], references: [id], onDelete: Cascade)
  
  messages Message[] // –°–æ–æ–±—â–µ–Ω–∏—è –≤ —ç—Ç–æ–º –∫–∞–Ω–∞–ª–µ
}

// --- –°–û–û–ë–©–ï–ù–ò–ï ---
model Message {
  id        Int      @id @default(autoincrement())
  content   String?  // –¢–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è (–º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º, –µ—Å–ª–∏ —ç—Ç–æ –∫–∞—Ä—Ç–∏–Ω–∫–∞)
  imageUrl  String?  // –°—Å—ã–ª–∫–∞ –Ω–∞ –∫–∞—Ä—Ç–∏–Ω–∫—É (base64)
  type      String   @default("text") // "text", "image", "call"
  
  isEdited  Boolean  @default(false) // –§–ª–∞–≥: –±—ã–ª–æ –ª–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–æ
  
  author    String   // –ò–º—è –∞–≤—Ç–æ—Ä–∞ (–¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞)
  userId    Int
  user      User     @relation(fields: [userId], references: [id])

  // –ï—Å–ª–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ –∫–∞–Ω–∞–ª–µ —Å–µ—Ä–≤–µ—Ä–∞
  channelId Int?
  channel   Channel? @relation(fields: [channelId], references: [id], onDelete: Cascade)
  
  // –ï—Å–ª–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ –õ–° (–Ω–∞–∑–≤–∞–Ω–∏–µ –∫–æ–º–Ω–∞—Ç—ã, –Ω–∞–ø—Ä–∏–º–µ—Ä "dm_1_2")
  dmRoom    String?  

  createdAt DateTime   @default(now())
  
  reactions Reaction[] // –†–µ–∞–∫—Ü–∏–∏ –Ω–∞ —ç—Ç–æ —Å–æ–æ–±—â–µ–Ω–∏–µ
}

// --- –†–ï–ê–ö–¶–ò–Ø (–ù–û–í–û–ï) ---
model Reaction {
  id        Int     @id @default(autoincrement())
  emoji     String  // –°–∞–º —Å–º–∞–π–ª–∏–∫ (–Ω–∞–ø—Ä–∏–º–µ—Ä "üëç")
  
  userId    Int
  user      User    @relation(fields: [userId], references: [id])
  
  messageId Int
  message   Message @relation(fields: [messageId], references: [id], onDelete: Cascade)
}

// --- –£–í–ï–î–û–ú–õ–ï–ù–ò–ï ---
model Notification {
  id         Int      @id @default(autoincrement())
  type       String   // "FRIEND_REQUEST", "SERVER_INVITE"
  status     String   @default("PENDING") // "ACCEPTED", "DECLINED"
  
  senderId   Int
  sender     User     @relation("Sender", fields: [senderId], references: [id])
  
  receiverId Int
  receiver   User     @relation("Receiver", fields: [receiverId], references: [id])
  
  // –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: —Å—Å—ã–ª–∫–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä (–¥–ª—è –∏–Ω–≤–∞–π—Ç–æ–≤)
  serverId   Int?
  server     Server?  @relation(fields: [serverId], references: [id], onDelete: Cascade)
  
  createdAt  DateTime @default(now())
}