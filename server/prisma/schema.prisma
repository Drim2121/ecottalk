// –≠—Ç–æ –≤–∞—à —Ñ–∞–π–ª —Å—Ö–µ–º—ã Prisma.
// –£–∑–Ω–∞–π—Ç–µ –±–æ–ª—å—à–µ –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = "file:./dev.db"
}

// --- –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–¨ ---
model User {
  id          Int       @id @default(autoincrement())
  username    String    @unique
  password    String
  avatar      String?   // –°—Å—ã–ª–∫–∞ –Ω–∞ –∞–≤–∞—Ç–∞—Ä–∫—É
  status      String    @default("offline") // online, offline
  lastSeen    DateTime?
  
  // –°–ø–∏—Å–æ–∫ –¥—Ä—É–∑–µ–π —Ö—Ä–∞–Ω–∏—Ç—Å—è –∫–∞–∫ JSON –º–∞—Å—Å–∏–≤ ID "[1, 2, 5]"
  friendsData String?   

  // === –ù–û–í–´–ï –ü–û–õ–Ø –î–õ–Ø –ú–ê–ì–ê–ó–ò–ù–ê ===
  coins             Int       @default(0) // üí∞ –ë–∞–ª–∞–Ω—Å EcoCoin
  inventoryData     String?   // üéí –°–ø–∏—Å–æ–∫ –∫—É–ø–ª–µ–Ω–Ω—ã—Ö ID –ø—Ä–µ–¥–º–µ—Ç–æ–≤ (JSON String)
  customizationData String?   // üé® –¢–µ–∫—É—â–∏–µ –Ω–∞–¥–µ—Ç—ã–µ –ø—Ä–µ–¥–º–µ—Ç—ã (JSON String: {frame, color})
  lastDailyBonus    DateTime? // üéÅ –î–∞—Ç–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –ø–æ–ª—É—á–µ–Ω–∏—è –±–æ–Ω—É—Å–∞
  // ===============================

  // –°–≤—è–∑–∏
  servers      Member[]       // –í –∫–∞–∫–∏—Ö —Å–µ—Ä–≤–µ—Ä–∞—Ö —Å–æ—Å—Ç–æ–∏—Ç
  owned        Server[]       // –ö–∞–∫–∏–µ —Å–µ—Ä–≤–µ—Ä–∞ —Å–æ–∑–¥–∞–ª
  messages     Message[]      // –û—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
  reactions    Reaction[]     // –ü–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã–µ —Ä–µ–∞–∫—Ü–∏–∏
  
  // –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
  sentNotif    Notification[] @relation("Sender")
  recvNotif    Notification[] @relation("Receiver")
}

// --- –°–ï–†–í–ï–† ---
model Server {
  id          Int       @id @default(autoincrement())
  name        String
  icon        String?
  description String?
  
  ownerId     Int
  owner       User      @relation(fields: [ownerId], references: [id])

  channels    Channel[]
  members     Member[]
  invites     Notification[] // –ü—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è –Ω–∞ —ç—Ç–æ—Ç —Å–µ—Ä–≤–µ—Ä
}

// --- –£–ß–ê–°–¢–ù–ò–ö –°–ï–†–í–ï–†–ê ---
model Member {
  id       Int    @id @default(autoincrement())
  userId   Int
  serverId Int
  
  user     User   @relation(fields: [userId], references: [id])
  server   Server @relation(fields: [serverId], references: [id], onDelete: Cascade)
}

// --- –ö–ê–ù–ê–õ ---
model Channel {
  id       Int       @id @default(autoincrement())
  name     String
  type     String    @default("text") // "text" –∏–ª–∏ "voice"
  
  serverId Int
  server   Server    @relation(fields: [serverId], references: [id], onDelete: Cascade)
  
  messages Message[] // –°–æ–æ–±—â–µ–Ω–∏—è –≤ —ç—Ç–æ–º –∫–∞–Ω–∞–ª–µ
}

// --- –°–û–û–ë–©–ï–ù–ò–ï ---
model Message {
  id        Int      @id @default(autoincrement())
  content   String?  // –¢–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è
  imageUrl  String?  // –°—Å—ã–ª–∫–∞ –Ω–∞ –∫–∞—Ä—Ç–∏–Ω–∫—É
  type      String   @default("text") 
  
  isEdited  Boolean  @default(false)
  
  author    String   // –ò–º—è –∞–≤—Ç–æ—Ä–∞
  userId    Int
  user      User     @relation(fields: [userId], references: [id])

  // === –ù–û–í–û–ï –ü–û–õ–ï ===
  // –•—Ä–∞–Ω–∏–º —Å—Ç–∏–ª—å –∞–≤—Ç–æ—Ä–∞ –≤ –º–æ–º–µ–Ω—Ç –æ—Ç–ø—Ä–∞–≤–∫–∏ (JSON), —á—Ç–æ–±—ã –≤ –∏—Å—Ç–æ—Ä–∏–∏ —á–∞—Ç–∞ 
  // —Å–æ–æ–±—â–µ–Ω–∏–µ –æ—Å—Ç–∞–≤–∞–ª–æ—Å—å —Ü–≤–µ—Ç–Ω—ã–º, –¥–∞–∂–µ –µ—Å–ª–∏ —é–∑–µ—Ä –ø–æ—Ç–æ–º –ø–æ–º–µ–Ω—è–µ—Ç —Ü–≤–µ—Ç.
  userCustomData String? 
  // ==================

  // –ï—Å–ª–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ –∫–∞–Ω–∞–ª–µ —Å–µ—Ä–≤–µ—Ä–∞
  channelId Int?
  channel   Channel? @relation(fields: [channelId], references: [id], onDelete: Cascade)
  
  // –ï—Å–ª–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ –õ–°
  dmRoom    String?  

  createdAt DateTime   @default(now())
  
  reactions Reaction[] 
}

// --- –†–ï–ê–ö–¶–ò–Ø ---
model Reaction {
  id        Int     @id @default(autoincrement())
  emoji     String  
  
  userId    Int
  user      User    @relation(fields: [userId], references: [id])
  
  messageId Int
  message   Message @relation(fields: [messageId], references: [id], onDelete: Cascade)
}

// --- –£–í–ï–î–û–ú–õ–ï–ù–ò–ï ---
model Notification {
  id          Int      @id @default(autoincrement())
  type        String   // "FRIEND_REQUEST", "SERVER_INVITE"
  status      String   @default("PENDING") 
  
  senderId    Int
  sender      User     @relation("Sender", fields: [senderId], references: [id])
  
  receiverId  Int
  receiver    User     @relation("Receiver", fields: [receiverId], references: [id])
  
  serverId    Int?
  server      Server?  @relation(fields: [serverId], references: [id], onDelete: Cascade)
  
  createdAt   DateTime @default(now())
}